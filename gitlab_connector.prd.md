# Product Requirements Document (PRD): custom_modules.gitlab_connector

---

## 1. Назначение

**custom_modules.gitlab_connector** — модуль для абстрагированной работы с GitLab API в рамках стека автоматизации инфраструктуры. Обеспечивает стандартизированное подключение, получение проектов и извлечение файлов из репозиториев, исключая необходимость дублирования низкоуровневой логики работы с GitLab в пользовательских скриптах.

---

## 2. Применение и архитектурные границы

- Является частью корпоративной библиотеки `custom_modules` и не является самостоятельным CLI-инструментом;
- Используется как универсальный адаптер GitLab для скриптов и утилит (например, `find_smth_in_gitlab.py`);
- Не решает бизнес- или доменные задачи поиска, анализа файлов или интеграции с другими системами (эти задачи реализуются на уровне вызывающих скриптов).

---

## 3. Основные функции

### 3.1. Загрузка и обработка параметров окружения

- Получает переменные окружения (`GITLAB_URL`, `GITLAB_PRIVATE_TOKEN`) либо из системы (`os.environ`), либо из `.env` файла (`python-dotenv`).
- При отсутствии нужных переменных инициирует понятное исключение, фиксирует ошибку в логах.

### 3.2. Установка и аутентификация соединения

- Предоставляет фабричный метод подключения к GitLab (`create_connection`), который аутентифицирует `python-gitlab` с токеном доступа.
- Все последующие запросы выполняются через единый `gitlab_connection`.

### 3.3. Получение проекта по `path_with_namespace`

- Метод `get_project(path)` получает проект по полному пути (`group/project` или `group/subgroup/project`), поддерживает работу с вложенными пространствами имён.
- Явно выбрасывает ошибки доступа и отсутствия проекта (с логированием).

### 3.4. Чтение файловых объектов

- Метод `get_file_content(project, file_path, ref='main')` возвращает содержимое файла из проекта GitLab.
- Возвращает `None` и пишет лог, если файл не найден.
- Точки интеграции: поиск любых текстовых данных в коде или инфраструктурных файлах в репозиториях.

### 3.5. Получение дерева репозитория

- Метод `get_repository_tree(project, ref='main')` возвращает структуру верхнего уровня дерева git-репозитория (используется для обхода структуры или валидации содержимого).

---

## 4. Описанные сценарии использования

- Быстрое получение файла из любого проекта GitLab с помощью пары функций;
- Многократное обращение к разным репозиториям GitLab в рамках единой сессии без переконнекта;
- Унификация обращения к GitLab во всех внутренних и служебных инструментах (find_smth_in_gitlab, CI-утилиты и др.).
